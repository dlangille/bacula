<%@ MasterClass="Application.Web.Layouts.Wizard" Theme="Baculum-v2"%>
<com:TContent ID="Wizard">
	<com:TWizard ID="RestoreWizard"
		CssClass="wizard"
		StepStyle.CssClass="w3-container"
		HeaderStyle.CssClass="w3-container"
		NavigationStyle.CssClass="w3-container"
		UseDefaultLayout="false"
		ShowSideBar="false"
		OnPreviousButtonClick="wizardPrev"
		OnNextButtonClick="wizardNext"
		OnCancelButtonClick="wizardStop"
		OnCompleteButtonClick="wizardCompleted"
		>
		<prop:HeaderTemplate>
			<div class="w3-half">
				<div class="w3-third w3-padding-16">
					<div class="step w3-padding w3-text-white w3-margin-right <%=($this->Parent->ActiveStepIndex === 0 ? 'w3-light-green' : 'w3-green')%>">
						<div class="w3-left"><i class="fa fa-desktop w3-xxxlarge"></i></div>
						<div class="w3-clear"></div>
						<h4><com:TTranslate Text="Client" /></h4>
					</div>
				</div>
				<div class="w3-third w3-padding-16">
					<div class="step w3-padding w3-text-white w3-margin-right <%=($this->Parent->ActiveStepIndex === 1 ? 'w3-light-green' : 'w3-green')%>">
						<div class="w3-left"><i class="fa fa-tasks w3-xxxlarge"></i></div>
						<div class="w3-clear"></div>
						<h4><com:TTranslate Text="Backup" /></h4>
					</div>
				</div>
				<div class="w3-third w3-padding-16">
					<div class="step w3-padding w3-text-white w3-margin-right <%=($this->Parent->ActiveStepIndex === 2 ? 'w3-light-green' : 'w3-green')%>">
						<div class="w3-left"><i class="fa fa-copy w3-xxxlarge"></i></div>
						<div class="w3-clear"></div>
						<h4><com:TTranslate Text="Files" /></h4>
					</div>
				</div>
			</div>
			<div class="w3-half">
				<div class="w3-third w3-padding-16">
					<div class="step w3-padding w3-text-white w3-margin-right <%=($this->Parent->ActiveStepIndex === 3  ? 'w3-light-green' : 'w3-green')%>">
						<div class="w3-left"><i class="fa fa-download w3-xxxlarge"></i></div>
						<div class="w3-clear"></div>
						<h4><com:TTranslate Text="Where" /></h4>
					</div>
				</div>
				<div class="w3-third w3-padding-16">
					<div class="step w3-padding w3-text-white w3-margin-right <%=($this->Parent->ActiveStepIndex === 4 ? 'w3-light-green' : 'w3-green')%>">
						<div class="w3-left"><i class="fa fa-clipboard-list w3-xxxlarge"></i></div>
						<div class="w3-clear"></div>
						<h4><com:TTranslate Text="Options" /></h4>
					</div>
				</div>
				<div class="w3-third w3-padding-16">
					<div class="step w3-padding w3-text-white w3-margin-right <%=($this->Parent->ActiveStepIndex === 5 ? 'w3-light-green' : 'w3-green')%>">
						<div class="w3-left"><i class="fa fa-paper-plane w3-xxxlarge"></i></div>
						<div class="w3-clear"></div>
						<h4><com:TTranslate Text="Run" /></h4>
					</div>
				</div>
			</div>
			<div class="step_title w3-panel w3-green w3-margin-right"><h3><%=$this->Parent->ActiveStep->Title%></h3></div>
		</prop:HeaderTemplate>
		<prop:StartNavigationTemplate>
			<div class="w3-center w3-section">
				<com:TLinkButton
					CommandName="Cancel"
					CssClass="w3-button w3-red"
				>
					<i class="fa fa-times"></i> &nbsp;<%[ Cancel ]%>
				</com:TLinkButton>
				<com:TLinkButton
					CommandName="NextStep"
					CssClass="w3-button w3-green"
				>
					<%[ Next ]%>&nbsp; <i class="fa fa-angle-right"></i>
				</com:TLinkButton>
			</div>
		</prop:StartNavigationTemplate>

		<prop:StepNavigationTemplate>
			<div class="w3-center w3-section">
				<com:TLinkButton CommandName="Cancel" CssClass="w3-button w3-red">
					<i class="fa fa-times"></i> &nbsp;<%[ Cancel ]%>
				</com:TLinkButton>
				<com:TLinkButton
					ID="PreviousStepBtn"
					CommandName="PreviousStep"
					CausesValidation="false"
					CssClass="w3-button w3-green"
				>
					<i class="fa fa-angle-left"></i> &nbsp;<%[ Previous ]%>
				</com:TLinkButton>
				<com:TLinkButton
					CommandName="NextStep"
					CssClass="w3-button w3-green"
					Visible="<%=($this->getPage()->RestoreWizard->ActiveStepIndex != 1 || ($this->getPage()->RestoreWizard->ActiveStepIndex == 1 && count($this->getPage()->jobs_to_restore) > 0))%>"
				>
					<%[ Next ]%>&nbsp; <i class="fa fa-angle-right"></i>
				</com:TLinkButton>
			</div>
		</prop:StepNavigationTemplate>
		 
		<prop:FinishNavigationTemplate>
			<div class="w3-center w3-section">
				<com:TLinkButton
					CommandName="PreviousStep"
					CausesValidation="false"
					CssClass="w3-button w3-green"
				>
					<%[ Previous ]%>&nbsp; <i class="fa fa-angle-left"></i>
				</com:TLinkButton>
				<com:TLinkButton
					CommandName="Complete"
					CssClass="w3-button w3-green"
				>
					<%[ Run restore ]%> &nbsp;<i class="fa fa-paper-plane"></i>
				</com:TLinkButton>
			</div>
		</prop:FinishNavigationTemplate>
		<com:TWizardStep ID="Step1" Title="<%[ Step 1 - select source backup client ]%>" StepType="Auto">
			<h2><%[ Restore wizard ]%></h2>
			<p>
				<%[ This wizard enables you to do in easy way restore files to destination Bacula Client. ]%>
				<%[ To start, please select backup Client which data you want to restore. ]%>
			</p>
			<div class="w3-container">
				<div class="w3-third"><com:TLabel ForControl="BackupClientName" Text="<%[ Backup from client: ]%>" /></div>
				<div class="w3-third">
					<com:TDropDownList ID="BackupClientName" CssClass="w3-select w3-border" CausesValidation="false" />
				</div>
			</div>
		</com:TWizardStep>
		<com:TWizardStep ID="Step2" Title="<%[ Step 2 - select backup to restore ]%>" StepType="Auto">
			<p>
				<%[ There are two ways to select backup to restore. Only selected backup way provides list of jobs from which there is possible to select one job. If you need the latest backups from the Client alternatively you can use Group most recent backups way which will select backups for you basing on backup job name and fileset resource. ]%>
			</p>
			<div class="w3-container w3-padding-16">
				<div class="w3-col w3-third"><com:TLabel Text="<%[ Backup selection method: ]%>" /></div>
				<div class="w3-col w3-third">
					<com:TRadioButton
						ID="OnlySelectedBackupSelection"
						GroupName="BackupSelection"
						CssClass="w3-radio"
						Checked="true"
						Attributes.onclick="$('#group_backup_to_restore_field').hide(); $('#backup_to_restore_field').show();"
					/>
					<com:TLabel ForControl="OnlySelectedBackupSelection" Text="<%[ Only selected backup ]%>" /> &nbsp;
					<com:TRadioButton
						ID="GroupBackupSelection"
						GroupName="BackupSelection"
						CssClass="w3-radio"
						Attributes.onclick="$('#backup_to_restore_field').hide(); $('#group_backup_to_restore_field').show();"
					/>
					<com:TLabel ForControl="GroupBackupSelection" Text="<%[ Group most recent backups ]%>" /></div>
			</div>
			<com:TLabel Text="<%[ There is no backup for restore. Please go to previous step and select another client for restore or proceed backups for the client selected in previous step. ]%>" CssClass="w3-text-red" Visible="<%=(count($this->getPage()->jobs_to_restore) === 0 && $this->GroupBackupToRestore->ItemCount == 0)%>"/>
			<div id="backup_to_restore_field" style="display: <%=!$this->OnlySelectedBackupSelection->Checked ? 'none' : 'block'%>">
				<p><%[ Backup for restore: ]%></p>
				<table id="job_to_restore_list" style="width: 100%">
					<thead>
						<th></th>
						<th>JobId</th>
						<th><%[ Job name ]%></th>
						<th><%[ Type ]%></th>
						<th><%[ Level ]%></th>
						<th><%[ Job status ]%></th>
						<th><%[ Size ]%></th>
						<th><%[ Files ]%></th>
						<th><%[ End time ]%></th>
						<th><%[ Select ]%></th>
					</thead>
					<tbody id="job_to_restore_list_body">
					</tbody>
				</table>
<script type="text/javascript">
var oJobsToRestoreList = {
	ids: {
		job_list: 'job_to_restore_list',
		job_list_body: 'job_to_restore_list_body'
	},
	init: function() {
		this.set_table();
	},
	set_table: function() {
		var table = $('#' + this.ids.job_list).DataTable({
			data: <%=json_encode(array_values($this->getPage()->jobs_to_restore))%>,
			deferRender: true,
			columns: [
				{
					className: 'details-control',
					orderable: false,
					data: null,
					defaultContent: '<button type="button" class="w3-button w3-blue"><i class="fa fa-angle-down"></i></button>'
				},
				{
					data: 'jobid',
					responsivePriority: 1
				},
				{
					data: 'name',
					responsivePriority: 3
				},
				{
					data: 'type',
					render: function(data, type, row) {
						return JobType.get_type(data);
					},
					responsivePriority: 4
				},
				{
					data: 'level',
					render: function(data, type, row) {
						return JobLevel.get_level(data);
					},
					responsivePriority: 5
				},
				{
					data: 'jobstatus',
					render: function (data, type, row) {
						var ret;
						if (type == 'display') {
							ret = JobStatus.get_icon(data).outerHTML;
						} else {
							ret = data;
						}
						return ret;
					},
					aresponsivePriority: 6
				},
				{
					data: 'jobbytes',
					render: function (data, type, row) {
						var s;
						if (type == 'display') {
							s = Units.get_formatted_size(data)
						} else {
							s = data;
						}
						return s;
					},
					responsivePriority: 7
				},
				{
					data: 'jobfiles',
					responsivePriority: 8
				},
				{
					data: 'endtime',
					responsivePriority: 9
				},
				{
					data: 'jobid',
					render: function (data, type, row) {
						var ret;
						if (type == 'display') {
							var radio = document.createElement('INPUT');
							radio.type = 'radio';
							radio.name = 'backup_to_restore';
							radio.value = data;
							radio.className = 'w3-radio';
							ret = radio.outerHTML;
						} else {
							ret = data;
						}
						return ret;
					},
					responsivePriority: 2
				}
			],
			responsive: {
				details: {
					type: 'column'
				}
			},
			columnDefs: [{
				className: 'control',
				orderable: false,
				targets: 0
			},
			{
				className: "dt-center",
				targets: [ 1, 3, 4, 5, 7, 8, 9 ]
			},
			{
				className: "dt-body-right",
				targets: [ 6 ]
			}],
			order: [1, 'desc']
		});
	}
};
oJobsToRestoreList.init();
</script>
			</div>
			<div id="group_backup_to_restore_field" style="display: <%=!$this->GroupBackupSelection->Checked ? 'none' : 'block'%>">
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><com:TLabel ForControl="GroupBackupToRestore" Text="<%[ Backup for restore: ]%>" /></div>
					<div class="w3-col w3-third">
						<com:TDropDownList
							ID="GroupBackupToRestore"
							CssClass="w3-select w3-border"
							CausesValidation="false"
						/>
					</div>
				</div>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><com:TLabel ForControl="GroupBackupFileSet" Text="<%[ FileSet resource: ]%>" /></div>
					<div class="w3-col w3-third">
						<com:TDropDownList
							ID="GroupBackupFileSet"
							CssClass="w3-select w3-border"
							CausesValidation="false"
						/>
					</div>
				</div>
			</div>
		</com:TWizardStep>
		<com:TWizardStep ID="Step3" Title="<%[ Step 3 - select files to restore ]%>" StepType="Auto">
			<div class="w3-row">
				<div class="w3-col" style="width: 15%;"><%[ Path: ]%></div>
				<div class="w3-col" style="width: 85%;">
					<com:TActiveTextBox
						ID="PathField"
						CssClass="w3-input w3-twothird w3-border"
						Style="display: inline"
						Attributes.onkeydown="var keycode = (event.keyCode ? event.keyCode : event.which); if (keycode === 13) {$('#<%=$this->LoadPathBtn->ClientID%>').click(); return false; } return true;"
						/>
					<com:TActiveLinkButton
						ID="LoadPathBtn"
						CssClass="w3-button w3-green"
						OnClick="loadPath">
						<prop:ClientSide.OnLoading>
							document.getElementById('restore-browser-files-loading').style.display = 'block';
						</prop:ClientSide.OnLoading>
						<prop:ClientSide.OnComplete>
							document.getElementById('restore-browser-files-loading').style.display = 'none';
						</prop:ClientSide.OnComplete>
						<i class="fa fa-check"></i> &nbsp;<%[ OK ]%>
					</com:TActiveLinkButton>
				</div>
			</div>
			<table id="restore-browser">
				<tr>
					<td rowspan="2">
						<div id="restore-browser-files-loading" style="display: none"></div>
						<div id="restore-browser-files" class="w3-border">
						<com:TActiveDataGrid
							ID="DataGridFiles"
							AutoGenerateColumns="false"
							CellPadding="2px"
							ShowHeader="false"
							CssClass="file-browser-detail"
							ItemStyle.CssClass="file-browser-element"
							DataKeyField="fileid"
							>
								<prop:EmptyTemplate>
									<div class="file-browser-watermark" style="padding: 200px 10px">
										<%[ It seems that there is no files for choosing or file records in database for this job has been purged (file retention period expired) ]%>
									</div>
								</prop:EmptyTemplate>
								<com:TActiveTemplateColumn>
									<prop:ItemTemplate>
										<com:TPanel ID="FileElementLeft" CssClass="draggable">
											<img src="<%=$this->getPage()->getTheme()->getBaseUrl()%>/<%=($this->getParent()->Data['type'] == 'dir' ? 'directory-icon' : 'file-icon')%>.png" alt="<%=$this->getParent()->Data['type'] == 'dir' ? 'directory' : 'file' %>" /> <%=($this->getParent()->Data['name'] != '/') ? preg_replace('/\/$/', '', $this->getParent()->Data['name']) : '/'%>
										<div class="restore-browser-element-size">
											<com:TActiveLinkButton
												CssClass="link"
												Style="float: right;"
												OnCallback="Page.addFileToRestore"
												ActiveControl.CallbackParameter="<%=isset($this->getParent()->Data['fileid']) ? $this->getParent()->Data['fileid'] : null%>"
												ActiveControl.EnableUpdate="false"
												Visible="<%=!in_array($this->getParent()->Data['name'], $this->getPage()->excluded_elements_from_add) && ($this->getParent()->Data['type'] !== 'dir' || !is_null($this->getParent()->Data['lstat']))%>"
												ClientSide.OnComplete="Formatters.set_formatters();"
												Text="<%[ Add ]%>"
											/>
											<span class="size" style=""><%=isset($this->getParent()->Data['lstat']['size']) ? $this->getParent()->Data['lstat']['size'] : '0'%></span>
										</div>
										</com:TPanel>
										<script type="text/javascript">
											document.getElementById('<%=$this->FileElementLeft->ClientID%>').addEventListener('click', function(event) {
												var el = event.target || event.srcElement;
												if (el.className == 'link') {
													// 'Add' link doesn't cause sending request
													return;
												}
												var vposition = el.style.left;
												if(vposition == null || vposition == '0px'){
													event.stop();
												} else {
													var cbp = "<%=$this->getParent()->Data['name']%>|<%=@$this->getParent()->Data['pathid']%>|<%=@$this->getParent()->Data['filenameid']%>|<%=@$this->getParent()->Data['jobid']%>";
													var request = <%=$this->getPage()->FileElementCall->ActiveControl->Javascript %>;
													request.setCallbackParameter(cbp);
													var ocf = request.options.onComplete;
													request.options.onComplete = function() {
														ocf();
														Formatters.set_formatters();
														make_draggable();
													};
													request.dispatch();
												}
											});
										</script>
									</prop:ItemTemplate>
								</com:TActiveTemplateColumn>
						</com:TActiveDataGrid>
						<com:TCallback ID="FileElementCall" OnCallback="Page.getVersions">
							<prop:ClientSide.OnLoading>
								document.getElementById('restore-browser-files-loading').style.display = 'block';
							</prop:ClientSide.OnLoading>
							<prop:ClientSide.OnComplete>
								document.getElementById('restore-browser-files-loading').style.display = 'none';
							</prop:ClientSide.OnComplete>
						</com:TCallback>
						</div>
					</td>
					<td>
						<div id="restore-browser-versions" class="w3-border" style="position: relative">
							<com:TActiveDataGrid
								ID="VersionsDataGrid"
								ShowHeader="false"
								AutoGenerateColumns="false"
								CellPadding="2px"
								CssClass="file-browser-detail"
								ItemStyle.CssClass="file-browser-element"
								DataKeyField="fileid"
							>
								<prop:EmptyTemplate>
									<div class="file-browser-watermark">
										<%[ For see a file versions please click file on the left files browser. ]%>
									</div>
								</prop:EmptyTemplate>
								<com:TActiveTemplateColumn>
									<prop:ItemTemplate>
										<com:TPanel ID="FileElementToRestore" CssClass="draggable" Style="height: 28px;">
											<span class="w3-third">
												<img src="<%=$this->getPage()->getTheme()->getBaseUrl()%>/<%=($this->getParent()->Data['type'] == 'dir' ? 'directory-icon' : 'file-icon')%>.png" alt="<%=$this->getParent()->Data['type'] == 'dir' ? 'directory' : 'file'%>" />
												 <%=$this->getParent()->Data['name']%>
											</span>
											<span class="w3-third">
												MTIME:<%=date("Y-m-d H:i:s", $this->getParent()->Data['lstat']['mtime'])%>
											</span>
											<span class="w3-third">
												<%[ Size: ]%>
												<span class="size"><%=$this->getParent()->Data['lstat']['size']%></span>
											<com:TActiveLinkButton
												CssClass="link"
												Style="float: right;"
												OnCallback="Page.addFileToRestore"
												ActiveControl.CallbackParameter="<%=isset($this->getParent()->Data['fileid']) ? $this->getParent()->Data['fileid'] : false%>"
												ActiveControl.EnableUpdate="false"
												ClientSide.OnComplete="Formatters.set_formatters();"
												Text="<%[ Add ]%>"
											/>
											</span>
										</com:TPanel>
										<script type="text/javascript">
											document.getElementById('<%=$this->FileElementToRestore->ClientID%>').addEventListener('mouseover', function(event) {
												var tip_fields = [
													'<%[ JobId: ]%> <%=$this->getParent()->Data['jobid']%>',
													'<%[ Volume: ]%> <%=$this->getParent()->Data['volname']%>',
													'<%[ InChanger: ]%> <%=$this->getParent()->Data['inchanger'] ? Prado::localize('Yes') : Prado::localize('No')%>',
													'<%[ Sum: ]%> <%=$this->getParent()->Data['md5']%>'
												];
												showTip(this, '<%=$this->getParent()->Data['name']%>', tip_fields.join('<br />'));
											});
										</script>
									</prop:ItemTemplate>
								</com:TActiveTemplateColumn>
							</com:TActiveDataGrid>
							</div>
					</td>
				</tr>
				<tr>
					<td style="vertical-align: bottom;">
						<div id="restore-browser-selected" class="w3-border">
							<com:TCallback
								ID="RemoveSelectedItem"
								OnCallback="removeSelectedFile"
								ClientSide.OnComplete="set_formatters();"
							/>
							<script type="text/javascript">
								function remove_selected_item(fileid) {
									var cb = <%=$this->RemoveSelectedItem->ActiveControl->Javascript%>;
									cb.setCallbackParameter(fileid);
									cb.dispatch();
								}
							</script>
							<com:TJuiDroppable ID="SelectedVersionsDropper" Height="100%" Width="100%"
								Options.accept=".draggable"
								OnDrop="addFileToRestore"
								OnDeactivate="callFormatters"
								>
									<com:TActiveDataGrid
										ID="SelectedVersionsDataGrid"
										ShowHeader="false"
										AutoGenerateColumns="false"
										CellPadding="2px"
										CssClass="file-browser-detail"
										ItemStyle.CssClass="file-browser-element"
										DataKeyField="fileid"
									>
									<prop:EmptyTemplate>
										<div class="file-browser-watermark" style="padding: 50px 10px">
											<%[ For add a file to restore please click 'Add' link or drag a file from frame on left or from above frame and drop it here ]%>
										</div>
									</prop:EmptyTemplate>
									<com:TActiveTemplateColumn>
										<prop:ItemTemplate>
												<com:TPanel ID="FileElement" Style="clear: both">
													<span class="w3-third">
														<img src="<%=$this->getPage()->getTheme()->getBaseUrl()%>/<%=($this->getParent()->Data['type'] == 'dir' ? 'directory-icon' : 'file-icon')%>.png" alt="<%=$this->getParent()->Data['type'] == 'dir' ? 'directory' : 'file'%>" />
														<%=$this->getParent()->Data['name']%>
													</span>
													<span class="w3-third">
														MTIME:<%=date("Y-m-d H:i:s", $this->getParent()->Data['lstat']['mtime'])%>
													</span>
													<span class="w3-third">
														<%[ Size: ]%><span class="size"><%=$this->getParent()->Data['lstat']['size']%></span>
														<input type="image" src="<%=$this->getPage()->getTheme()->getBaseUrl()%>/icon_close.png" alt="" class="w3-right" onclick="remove_selected_item('<%=isset($this->getParent()->Data['fileid']) ? $this->getParent()->Data['fileid'] : ''%>'); return false;">
													</span>
												</com:TPanel>
										</prop:ItemTemplate>
									</com:TActiveTemplateColumn>
									</com:TActiveDataGrid>
								</com:TJuiDroppable>
						</div>
					</td>
				</tr>
			</table>
			<div id="invalid_path_to_restore_modal" class="w3-modal" style="display: none">
				<div class="w3-modal-content w3-card-4 w3-animate-zoom w3-padding" style="max-width: 600px">
					<span onclick="document.getElementById('invalid_path_to_restore_modal').style.display='none'" class="w3-button w3-xlarge w3-hover-red w3-display-topright">&times;</span>
					<h4><%[ Invalid path to restore ]%></h4>
					<div class="w3-section">
						<p><%[ Selected directory cannot be restored. Usually it means that the directory path contains in the path defined in FileSet (ex. selected path: /home, in FileSet: File = "/home/john/Documents"). ]%></p>
						<p><%[ Please select other path which is inside paths defined in FileSet. ]%></p>
					</div>
					<div class="w3-center">
						<button class="w3-button w3-red" type="button" onclick="document.getElementById('invalid_path_to_restore_modal').style.display='none'"><i class="fa fa-times"></i> &nbsp;<%[ OK ]%></button>
					</div>
				</div>
			</div>
			<script type="text/javascript">
				var browser = document.getElementById('restore-browser-files');
				document.getElementById('restore-browser-files-loading').style.width = browser.offsetWidth + 'px';
				document.getElementById('restore-browser-files-loading').style.height = browser.offsetHeight + 'px';
				function show_invalid_path_to_restore() {
					document.getElementById('invalid_path_to_restore_modal').style.display = 'block';
				}
				function make_draggable() {
					$('.draggable').draggable({
						'helper':"clone",
						'scroll':false,
						'appendTo':"body",
						'containment':"window"
					});
				}
				make_draggable('<%=$this->getPage()->DataGridFiles->ClientID%>');
				Formatters.set_formatters();
			</script>
		</com:TWizardStep>
		<com:TWizardStep ID="Step4" Title="<%[ Step 4 - select destination for restore ]%>" StepType="Auto">
			<div class="w3-section w3-row">
				<div class="w3-col w3-third"><com:TLabel ForControl="RestoreClient" Text="<%[ Restore to client: ]%>" /></div>
				<div class="w3-col w3-third">
					<com:TDropDownList ID="RestoreClient" CssClass="w3-select w3-border" CausesValidation="false" />
				</div>
			</div>
			<div class="w3-section w3-row">
				<div class="w3-col w3-third"><com:TLabel ForControl="RestorePath" Text="<%[ Restore to directory: ]%>" /></div>
				<div class="w3-col w3-third"><com:TTextBox ID="RestorePath" CssClass="w3-input w3-border" Text="/tmp/restore" /></div>
			</div>
			<hr style="w3-margin" />
			<p><%[ During restore there will be used following volumes: ]%></p>
			<com:TRepeater ID="RestoreVolumes">
				<prop:HeaderTemplate>
					<table class="w3-table w3-striped w3-border w3-hoverable w3-white w3-margin-bottom" style="width: 50%">
						<thead>
							<tr>
								<th><%[ In Changer ]%></th>
								<th><%[ Volume ]%></th>
							</tr>
						</thead>
				</prop:HeaderTemplate>
				<prop:ItemTemplate>
						<tr>
							<td class="center"><com:TLabel Text="<%#($this->Data['inchanger'] == 1 ? Prado::localize('Yes') : Prado::localize('No'))%>" /></td>
							<td> <i class="fa fa-hdd w3-text-black"></i> <com:TLabel Text="<%#$this->Data['volume']%>" /></td>
						</tr>
				</prop:ItemTemplate>
				<prop:FooterTemplate>
					</table>
				</prop:FooterTemplate>
			</com:TRepeater>
		</com:TWizardStep>
		<com:TWizardStep ID="Step5" Title="<%[ Step 5 - options for restore ]%>" StepType="Auto">
			<div class="w3-section w3-row">
				<div class="w3-col w3-third"><com:TLabel ForControl="RestoreJob" Text="<%[ Restore job: ]%>" /></div>
				<div class="w3-col w3-third">
					<com:TDropDownList ID="RestoreJob" CssClass="w3-select w3-border" CausesValidation="false" />
				</div>
			</div>
			<div class="w3-section w3-row">
				<div class="w3-col w3-third"><com:TLabel ForControl="ReplaceFiles" Text="<%[ Replace files: ]%>" /></div>
				<div class="w3-col w3-third">
					<com:TDropDownList ID="ReplaceFiles" CssClass="w3-select w3-border" CausesValidation="false">
						<com:TListItem Value="never" Text="<%[ do not replace files ]%>" />
						<com:TListItem Value="ifolder" Text="<%[ if files from restore are older]%>" />
						<com:TListItem Value="ifnewer" Text="<%[ if files from restore are newer]%>" />
						<com:TListItem Value="always" Text="<%[ always replace files ]%>" />
					</com:TDropDownList>
				</div>
			</div>
			<div class="w3-section w3-row">
				<div class="w3-col w3-third"><com:TLabel ForControl="RestoreJobPriority" Text="<%[ Restore job priority: ]%>" /></div>
				<div class="w3-col w3-third">
					<com:TTextBox ID="RestoreJobPriority" CssClass="w3-input w3-border" CausesValidation="false" MaxLength="5" Text="10" />
				</div>
			</div>
			<div class="w3-section w3-row w3-margin-bottom">
				<div class="w3-col w3-third"><%[ File relocation option:  ]%></div>
				<div class="w3-col w3-third">
					<input type="radio" name="file_relocation" id="file_relocation_1" value="1" class="w3-radio" onclick="switch_file_relocation_mode(this.value)" /> <label for="file_relocation_1"><%[ Do not relocate files ]%></label><br />
					<input type="radio" name="file_relocation" id="file_relocation_2" value="2" class="w3-radio" onclick="switch_file_relocation_mode(this.value)" /> <label for="file_relocation_2"><%[ Relocate files with prefix and/or suffix ]%></label><br />
					<input type="radio" name="file_relocation" id="file_relocation_3" value="3" class="w3-radio" onclick="switch_file_relocation_mode(this.value)" /> <label for="file_relocation_3"><%[ Relocate files with regular expression ]%></label>
				</div>
			</div>
			<div id="file_relocation_prefix_suffix" style="display: none">
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><com:TLabel ForControl="RestoreStripPrefix" Text="<%[ Strip prefix: ]%>" /></div>
					<div class="w3-col w3-third">
						<com:TTextBox ID="RestoreStripPrefix" CssClass="w3-input w3-border" CausesValidation="false" />
					</div>
				</div>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><com:TLabel ForControl="RestoreAddPrefix" Text="<%[ Add prefix: ]%>" /></div>
					<div class="w3-col w3-third">
						<com:TTextBox ID="RestoreAddPrefix" CssClass="w3-input w3-border" CausesValidation="false" />
					</div>
				</div>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><com:TLabel ForControl="RestoreAddSuffix" Text="<%[ Add suffix: ]%>" /></div>
					<div class="w3-col w3-third">
						<com:TTextBox ID="RestoreAddSuffix" CssClass="w3-input w3-border" CausesValidation="false" />
					</div>
				</div>
			</div>
			<div id="file_relocation_regex_where" style="display: none">
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><com:TLabel ForControl="RestoreRegexWhere" Text="<%[ RegexWhere: ]%>" /></div>
					<div class="w3-col w3-third">
						<com:TTextBox ID="RestoreRegexWhere" CssClass="w3-input w3-border" CausesValidation="false" />
					</div>
				</div>
			</div>
			<script type="text/javascript">
				function switch_file_relocation_mode(opt) {
					var prefix_suffix_opts = document.getElementById('file_relocation_prefix_suffix');
					var regex_where_opts = document.getElementById('file_relocation_regex_where');
					var radio = document.getElementById('file_relocation_' + opt);
					if (opt == 1) { // don't use file relocation
						prefix_suffix_opts.style.display = 'none';
						regex_where_opts.style.display = 'none';
						radio.checked = true;
					} else if (opt == 2) { // use prefix/suffix relocation
						prefix_suffix_opts.style.display = '';
						regex_where_opts.style.display = 'none';
						radio.checked = true;
					} else if (opt == 3) { // use regex_where relocation
						prefix_suffix_opts.style.display = 'none';
						regex_where_opts.style.display = '';
						radio.checked = true;
					}
				}
				var relocation_opt = '<%=$this->file_relocation_opt%>';
				if (relocation_opt) {
					switch_file_relocation_mode(relocation_opt);
				} else {
					switch_file_relocation_mode(1); // default setting
				}
			</script>
		</com:TWizardStep>
		<com:TWizardStep ID="Step6" Title="<%[ Step 6 - Finish ]%>" StepType="Finish">
			<fieldset>
				<legend><%[ Source parameters ]%></legend>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><%[ Backup data from client: ]%></div>
					<div class="w3-col w3-third bold"><%=$this->BackupClientName->SelectedValue%></div>
				</div>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><%[ Backup selection method: ]%></div>
					<div class="w3-col w3-third bold">
						<com:TLabel Text="<%[ Only selected backup ]%>" Visible="<%=$this->OnlySelectedBackupSelection->Checked%>" />
						<com:TLabel Text="<%[ Group most recent backups ]%>" Visible="<%=$this->GroupBackupSelection->Checked%>" />
					</div>
				</div>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><%[ Backup for restore: ]%></div>
					<div class="w3-col w3-third bold">
						<com:TLabel Text="<%=$this->GroupBackupToRestore->SelectedValue%>" Visible="<%=$this->GroupBackupSelection->Checked%>" />
					</div>
				</div>
				<com:TPanel Visible="<%=$this->GroupBackupSelection->Checked%>">
					<div class="w3-section w3-row">
						<div class="w3-col w3-third"><%[ FileSet for restore: ]%></div>
						<div class="w3-col w3-third bold"><%=$this->GroupBackupFileSet->SelectedValue%></div>
					</div>
				</com:TPanel>
			</fieldset>
			<fieldset>
				<legend><%[ Files for restore ]%></legend>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><%[ Selected directories count: ]%></div>
					<div class="w3-col w3-third bold"><%=isset($this->getRestoreElements(true)->dirid) ? count($this->getRestoreElements(true)->dirid) : '0'%></div>
				</div>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><%[ Selected files count: ]%></div>
					<div class="w3-col w3-third bold"><%=isset($this->getRestoreElements(true)->fileid) ? count($this->getRestoreElements(true)->fileid) : '0'%></div>
				</div>
			</fieldset>
			<fieldset>
				<legend><%[ Destination parameters ]%></legend>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><%[ Restore to client: ]%></div>
					<div class="w3-col w3-third bold"><%=$this->RestoreClient->SelectedValue%></div>
				</div>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><%[ Restore to path: ]%></div>
					<div class="w3-col w3-third bold"><%=$this->RestorePath->Text%></div>
				</div>
			</fieldset>
			<fieldset>
				<legend><%[ Restore job options ]%></legend>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><%[ Restore job: ]%></div>
					<div class="w3-col w3-third bold"><%=$this->RestoreJob->Text%></div>
				</div>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><%[ Replace files: ]%></div>
					<div class="w3-col w3-third bold">
						<com:TLabel Visible="<%=$this->ReplaceFiles->SelectedValue == 'never'%>" Text="<%[ do not replace files ]%>"/>
						<com:TLabel Visible="<%=$this->ReplaceFiles->SelectedValue == 'ifolder'%>" Text="<%[ if files from restore are older]%>"/>
						<com:TLabel Visible="<%=$this->ReplaceFiles->SelectedValue == 'ifnewer'%>" Text="<%[ if files from restore are newer]%>"/>
						<com:TLabel Visible="<%=$this->ReplaceFiles->SelectedValue == 'always'%>" Text="<%[ always replace files ]%>"/>
					</div>
				</div>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><%[ Restore job priority: ]%></div>
					<div class="w3-col w3-third bold"><%=$this->RestoreJobPriority->Text%></div>
				</div>
				<div class="w3-section w3-row">
					<div class="w3-col w3-third"><%[ File relocation option: ]%></div>
					<div class="w3-col w3-third bold">
						<com:TLabel Visible="<%=$this->file_relocation_opt == 1%>" Text="<%[ Do not relocate files ]%>"/>
						<com:TLabel Visible="<%=$this->file_relocation_opt == 2%>" Text="<%[ Relocate files with prefix and/or suffix ]%>"/>
						<com:TLabel Visible="<%=$this->file_relocation_opt == 3%>" Text="<%[ Relocate files with regular expression ]%>"/>
					</div>
				</div>
				<div style="display: <%=$this->file_relocation_opt == 2 ? 'block' : 'none'%>">
					<div class="w3-section w3-row">
						<div class="w3-col w3-third"><%[ Strip prefix: ]%></div>
						<div class="w3-col w3-third bold"><%=$this->RestoreStripPrefix->Text%></div>
					</div>
					<div class="w3-section w3-row">
						<div class="w3-col w3-third"><%[ Add prefix: ]%></div>
						<div class="w3-col w3-third bold"><%=$this->RestoreAddPrefix->Text%></div>
					</div>
					<div class="w3-section w3-row">
						<div class="w3-col w3-third"><%[ Add suffix: ]%></div>
						<div class="w3-col w3-third bold"><%=$this->RestoreAddSuffix->Text%></div>
					</div>
				</div>
				<div style="display: <%=$this->file_relocation_opt == 3 ? 'block' : 'none'%>">
					<div class="w3-section w3-row">
						<div class="w3-col w3-third"><%[ RegexWhere: ]%></div>
						<div class="w3-col w3-third bold"><%=$this->RestoreRegexWhere->Text%></div>
					</div>
				</div>
			</fieldset>
			<div id="restore_error" class="w3-modal" style="display: <%=$this->getPage()->show_error ? 'block' : 'none'%>">
				<div class="w3-modal-content w3-card-4 w3-animate-zoom w3-padding" style="max-width: 600px">
					<h2>Error</h2>
					<div><br />
						<span onclick="document.getElementById('restore_error').style.display='none'" class="w3-button w3-xlarge w3-hover-red w3-display-topright" title="Close Modal">&times;</span>
						<com:TLabel ID="RestoreError" CssClass="w3-text-red" />
					</div>
					<div class="w3-center">
						<a class="w3-button w3-red w3-section" type="button" href="<%=$this->Service->constructUrl('Dashboard');%>"><i class="fa fa-times"></i> &nbsp;<%[ Exit wizard ]%></a>
					</div>
				</div>
			</div>
		</com:TWizardStep>
	</com:TWizard>
</com:TContent>
